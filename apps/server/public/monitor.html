<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Voice CSR Monitor</title>
  <style>
    body { font-family: ui-sans-serif, system-ui, Arial; margin: 20px; }
    .row { padding: 8px 12px; border-bottom: 1px solid #eee; }
    .type { font-weight: 600; margin-right: 8px; }
    .assistant { color: #2d6cdf; }
    .tool { color: #8b5cf6; }
    .audio { color: #10b981; }
    pre { margin: 0; white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>
  <h1>Voice CSR — Live Monitor</h1>
  <p>Open this while you place a test call. You’ll see assistant text, audio bytes, and tool calls/results stream in.</p>
  <div id="log"></div>

  <script>
    const log = document.getElementById('log');
    const es = new EventSource('/monitor/events');

    function addRow(type, payload, cls) {
      const div = document.createElement('div');
      div.className = 'row';
      const t = document.createElement('span');
      t.className = 'type ' + (cls || '');
      t.textContent = type + ':';
      const pre = document.createElement('pre');
      pre.textContent = JSON.stringify(payload, null, 2);
      div.appendChild(t);
      div.appendChild(pre);
      log.prepend(div);
    }

    es.onmessage = (e) => {
      try {
        const evt = JSON.parse(e.data);
        if (evt.type === 'assistant_text') return addRow('assistant', evt.payload, 'assistant');
        if (evt.type === 'assistant_audio') return addRow('audio', evt.payload, 'audio');
        if (evt.type === 'tool_call') return addRow('tool_call', evt.payload, 'tool');
        if (evt.type === 'tool_result') return addRow('tool_result', evt.payload, 'tool');
        addRow(evt.type, evt.payload);
      } catch (err) {
        console.error(err);
      }
    };
  </script>
</body>
</html>
